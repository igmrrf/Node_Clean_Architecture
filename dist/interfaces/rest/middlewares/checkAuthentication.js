"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
var tslib_1 = require("tslib");
/**
 * Access control policies
 */
var awilix_1 = require("awilix");
var jwt_1 = tslib_1.__importDefault(require("../../../helpers/jwt"));
var Unauthorized_1 = tslib_1.__importDefault(require("../errors/Unauthorized"));
/**
 * Authenticates requests made to the server
 */
var CheckAuth = /** @class */ (function () {
  function CheckAuth(_a) {
    var User = _a.models.User;
    this.User = User;
  }
  /**
   * Returns the registered user making a request
   * @param {Object} req - Incoming request
   * @returns {{ error, user }}
   */
  CheckAuth.prototype.getUserFromRequest = function (req) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
      var authorizationHeader, requestToken, payload, user;
      return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
          case 0:
            if (!req.headers.authorization) {
              return [2 /*return*/, null];
            }
            authorizationHeader = req.headers.authorization;
            requestToken = authorizationHeader.split("Bearer").pop().trim();
            return [4 /*yield*/, jwt_1.default.decodeJWT(requestToken)];
          case 1:
            payload = _a.sent();
            return [4 /*yield*/, this.User.findById(payload.sub)];
          case 2:
            user = _a.sent();
            return [2 /*return*/, user];
        }
      });
    });
  };
  /**
   * Allows only registered users to make requests
   * @param {Object} req - Incoming request
   * @param {Object} res - Server response
   * @param {Function} next - Next middleware
   */
  CheckAuth.prototype.isLoggedIn = function (req, res, next) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
      var user, error_1;
      return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
          case 0:
            _a.trys.push([0, 2, , 3]);
            return [4 /*yield*/, this.getUserFromRequest(req)];
          case 1:
            user = _a.sent();
            if (!user) {
              throw new Unauthorized_1.default();
            }
            req.container.register({
              currentUser: (0, awilix_1.asValue)(user),
            });
            next();
            return [3 /*break*/, 3];
          case 2:
            error_1 = _a.sent();
            if (jwt_1.default.isJWTError(error_1)) {
              throw new Unauthorized_1.default("Failed to verify request token - ".concat(error_1.message));
            }
            throw error_1;
          case 3:
            return [2 /*return*/];
        }
      });
    });
  };
  /**
   * Allows only registered Staffs to make requests
   * @param {Object} req - Incoming request
   * @param {Object} res - Server response
   * @param {Function} next - Next middleware
   */
  CheckAuth.prototype.isStaff = function (req, res, next) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
      var staff, error_2;
      return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
          case 0:
            _a.trys.push([0, 2, , 3]);
            return [4 /*yield*/, this.getUserFromRequest(req)];
          case 1:
            staff = _a.sent();
            if (!staff || staff.type !== "staff") {
              throw new Unauthorized_1.default();
            }
            req.container.register({
              currentUser: (0, awilix_1.asValue)(staff),
            });
            next();
            return [3 /*break*/, 3];
          case 2:
            error_2 = _a.sent();
            if (jwt_1.default.isJWTError(error_2)) {
              throw new Unauthorized_1.default("Failed to verify request token - ".concat(error_2.message));
            }
            throw error_2;
          case 3:
            return [2 /*return*/];
        }
      });
    });
  };
  /**
   * Allows only Admin roled Staffs to make requests
   * @param {Object} req - Incoming request
   * @param {Object} res - Server response
   * @param {Function} next - Next middleware
   */
  CheckAuth.prototype.isAdmin = function (req, res, next) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
      var staff, error_3;
      return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
          case 0:
            _a.trys.push([0, 2, , 3]);
            return [4 /*yield*/, this.getStaffFromRequest(req)];
          case 1:
            staff = _a.sent();
            if (staff.role !== "admin") {
              throw new Unauthorized_1.default();
            }
            req.container.register({
              currentUser: (0, awilix_1.asValue)(staff),
            });
            next();
            return [3 /*break*/, 3];
          case 2:
            error_3 = _a.sent();
            if (jwt_1.default.isJWTError(error_3)) {
              throw new Unauthorized_1.default("Failed to verify request token - ".concat(error_3.message));
            }
            throw error_3;
          case 3:
            return [2 /*return*/];
        }
      });
    });
  };
  /**
   * Allows both authenticated and un-authenticated users to make requests
   * @param {Object} req - Incoming request
   * @param {Object} res - Server response
   * @param {Function} next - Next middleware
   */
  CheckAuth.prototype.allowAny = function (req, res, next) {
    return tslib_1.__awaiter(this, void 0, void 0, function () {
      var user, error_4;
      return tslib_1.__generator(this, function (_a) {
        switch (_a.label) {
          case 0:
            _a.trys.push([0, 2, , 3]);
            return [4 /*yield*/, this.getUserFromRequest(req)];
          case 1:
            user = _a.sent();
            req.container.register({
              currentUser: (0, awilix_1.asValue)(user, {
                lifetime: awilix_1.Lifetime.SCOPED,
              }),
            });
            next();
            return [3 /*break*/, 3];
          case 2:
            error_4 = _a.sent();
            if (jwt_1.default.isJWTError(error_4)) {
              throw new Unauthorized_1.default("Failed to verify request token - ".concat(error_4.message));
            }
            throw error_4;
          case 3:
            return [2 /*return*/];
        }
      });
    });
  };

  return CheckAuth;
})();
exports.default = CheckAuth;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInRzbGliXzEiLCJyZXF1aXJlIiwiYXdpbGl4XzEiLCJqd3RfMSIsIl9faW1wb3J0RGVmYXVsdCIsIlVuYXV0aG9yaXplZF8xIiwiQ2hlY2tBdXRoIiwiX2EiLCJVc2VyIiwibW9kZWxzIiwicHJvdG90eXBlIiwiZ2V0VXNlckZyb21SZXF1ZXN0IiwicmVxIiwiX19hd2FpdGVyIiwiYXV0aG9yaXphdGlvbkhlYWRlciIsInJlcXVlc3RUb2tlbiIsInBheWxvYWQiLCJ1c2VyIiwiX19nZW5lcmF0b3IiLCJsYWJlbCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwic3BsaXQiLCJwb3AiLCJ0cmltIiwiZGVmYXVsdCIsImRlY29kZUpXVCIsInNlbnQiLCJmaW5kQnlJZCIsInN1YiIsImlzTG9nZ2VkSW4iLCJyZXMiLCJuZXh0IiwiZXJyb3JfMSIsInRyeXMiLCJwdXNoIiwiY29udGFpbmVyIiwicmVnaXN0ZXIiLCJjdXJyZW50VXNlciIsImFzVmFsdWUiLCJpc0pXVEVycm9yIiwiY29uY2F0IiwibWVzc2FnZSIsImlzU3RhZmYiLCJzdGFmZiIsImVycm9yXzIiLCJ0eXBlIiwiaXNBZG1pbiIsImVycm9yXzMiLCJnZXRTdGFmZkZyb21SZXF1ZXN0Iiwicm9sZSIsImFsbG93QW55IiwiZXJyb3JfNCIsImxpZmV0aW1lIiwiTGlmZXRpbWUiLCJTQ09QRUQiXSwic291cmNlcyI6WyIuLi8uLi8uLi8uLi90eXBlZC9pbnRlcmZhY2VzL3Jlc3QvbWlkZGxld2FyZXMvY2hlY2tBdXRoZW50aWNhdGlvbi5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbnZhciB0c2xpYl8xID0gcmVxdWlyZShcInRzbGliXCIpO1xuLyoqXG4gKiBBY2Nlc3MgY29udHJvbCBwb2xpY2llc1xuICovXG52YXIgYXdpbGl4XzEgPSByZXF1aXJlKFwiYXdpbGl4XCIpO1xudmFyIGp3dF8xID0gdHNsaWJfMS5fX2ltcG9ydERlZmF1bHQocmVxdWlyZShcImhlbHBlcnMvand0XCIpKTtcbnZhciBVbmF1dGhvcml6ZWRfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJpbnRlcmZhY2VzL3Jlc3QvZXJyb3JzL1VuYXV0aG9yaXplZFwiKSk7XG4vKipcbiAqIEF1dGhlbnRpY2F0ZXMgcmVxdWVzdHMgbWFkZSB0byB0aGUgc2VydmVyXG4gKi9cbnZhciBDaGVja0F1dGggPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gQ2hlY2tBdXRoKF9hKSB7XG4gICAgICAgIHZhciBVc2VyID0gX2EubW9kZWxzLlVzZXI7XG4gICAgICAgIHRoaXMuVXNlciA9IFVzZXI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHJlZ2lzdGVyZWQgdXNlciBtYWtpbmcgYSByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcSAtIEluY29taW5nIHJlcXVlc3RcbiAgICAgKiBAcmV0dXJucyB7eyBlcnJvciwgdXNlciB9fVxuICAgICAqL1xuICAgIENoZWNrQXV0aC5wcm90b3R5cGUuZ2V0VXNlckZyb21SZXF1ZXN0ID0gZnVuY3Rpb24gKHJlcSkge1xuICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBhdXRob3JpemF0aW9uSGVhZGVyLCByZXF1ZXN0VG9rZW4sIHBheWxvYWQsIHVzZXI7XG4gICAgICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMiAvKnJldHVybiovLCBudWxsXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhvcml6YXRpb25IZWFkZXIgPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVxdWVzdFRva2VuID0gYXV0aG9yaXphdGlvbkhlYWRlci5zcGxpdChcIkJlYXJlclwiKS5wb3AoKS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCBqd3RfMS5kZWZhdWx0LmRlY29kZUpXVChyZXF1ZXN0VG9rZW4pXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgcGF5bG9hZCA9IF9hLnNlbnQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuVXNlci5maW5kQnlJZChwYXlsb2FkLnN1YildO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsyIC8qcmV0dXJuKi8sIHVzZXJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIEFsbG93cyBvbmx5IHJlZ2lzdGVyZWQgdXNlcnMgdG8gbWFrZSByZXF1ZXN0c1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBJbmNvbWluZyByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcyAtIFNlcnZlciByZXNwb25zZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG5leHQgLSBOZXh0IG1pZGRsZXdhcmVcbiAgICAgKi9cbiAgICBDaGVja0F1dGgucHJvdG90eXBlLmlzTG9nZ2VkSW4gPSBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcbiAgICAgICAgcmV0dXJuIHRzbGliXzEuX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdXNlciwgZXJyb3JfMTtcbiAgICAgICAgICAgIHJldHVybiB0c2xpYl8xLl9fZ2VuZXJhdG9yKHRoaXMsIGZ1bmN0aW9uIChfYSkge1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoX2EubGFiZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAwOlxuICAgICAgICAgICAgICAgICAgICAgICAgX2EudHJ5cy5wdXNoKFswLCAyLCAsIDNdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbNCAvKnlpZWxkKi8sIHRoaXMuZ2V0VXNlckZyb21SZXF1ZXN0KHJlcSldO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZF8xLmRlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcS5jb250YWluZXIucmVnaXN0ZXIoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyOiAoMCwgYXdpbGl4XzEuYXNWYWx1ZSkodXNlciksXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbMyAvKmJyZWFrKi8sIDNdO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDI6XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvcl8xID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGp3dF8xLmRlZmF1bHQuaXNKV1RFcnJvcihlcnJvcl8xKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRfMS5kZWZhdWx0KFwiRmFpbGVkIHRvIHZlcmlmeSByZXF1ZXN0IHRva2VuIC0gXCIuY29uY2F0KGVycm9yXzEubWVzc2FnZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3JfMTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAzOiByZXR1cm4gWzIgLypyZXR1cm4qL107XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogQWxsb3dzIG9ubHkgcmVnaXN0ZXJlZCBTdGFmZnMgdG8gbWFrZSByZXF1ZXN0c1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBJbmNvbWluZyByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcyAtIFNlcnZlciByZXNwb25zZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG5leHQgLSBOZXh0IG1pZGRsZXdhcmVcbiAgICAgKi9cbiAgICBDaGVja0F1dGgucHJvdG90eXBlLmlzU3RhZmYgPSBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcbiAgICAgICAgcmV0dXJuIHRzbGliXzEuX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RhZmYsIGVycm9yXzI7XG4gICAgICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMCwgMiwgLCAzXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmdldFVzZXJGcm9tUmVxdWVzdChyZXEpXTtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAxOlxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhZmYgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0YWZmIHx8IHN0YWZmLnR5cGUgIT09IFwic3RhZmZcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRfMS5kZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuY29udGFpbmVyLnJlZ2lzdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlcjogKDAsIGF3aWxpeF8xLmFzVmFsdWUpKHN0YWZmKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoand0XzEuZGVmYXVsdC5pc0pXVEVycm9yKGVycm9yXzIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZF8xLmRlZmF1bHQoXCJGYWlsZWQgdG8gdmVyaWZ5IHJlcXVlc3QgdG9rZW4gLSBcIi5jb25jYXQoZXJyb3JfMi5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcl8yO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBBbGxvd3Mgb25seSBBZG1pbiByb2xlZCBTdGFmZnMgdG8gbWFrZSByZXF1ZXN0c1xuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXEgLSBJbmNvbWluZyByZXF1ZXN0XG4gICAgICogQHBhcmFtIHtPYmplY3R9IHJlcyAtIFNlcnZlciByZXNwb25zZVxuICAgICAqIEBwYXJhbSB7RnVuY3Rpb259IG5leHQgLSBOZXh0IG1pZGRsZXdhcmVcbiAgICAgKi9cbiAgICBDaGVja0F1dGgucHJvdG90eXBlLmlzQWRtaW4gPSBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcbiAgICAgICAgcmV0dXJuIHRzbGliXzEuX19hd2FpdGVyKHRoaXMsIHZvaWQgMCwgdm9pZCAwLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgc3RhZmYsIGVycm9yXzM7XG4gICAgICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2dlbmVyYXRvcih0aGlzLCBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKF9hLmxhYmVsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMDpcbiAgICAgICAgICAgICAgICAgICAgICAgIF9hLnRyeXMucHVzaChbMCwgMiwgLCAzXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gWzQgLyp5aWVsZCovLCB0aGlzLmdldFN0YWZmRnJvbVJlcXVlc3QocmVxKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YWZmID0gX2Euc2VudCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN0YWZmLnJvbGUgIT09IFwiYWRtaW5cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBVbmF1dGhvcml6ZWRfMS5kZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuY29udGFpbmVyLnJlZ2lzdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlcjogKDAsIGF3aWxpeF8xLmFzVmFsdWUpKHN0YWZmKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzMgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoand0XzEuZGVmYXVsdC5pc0pXVEVycm9yKGVycm9yXzMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZF8xLmRlZmF1bHQoXCJGYWlsZWQgdG8gdmVyaWZ5IHJlcXVlc3QgdG9rZW4gLSBcIi5jb25jYXQoZXJyb3JfMy5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcl8zO1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBBbGxvd3MgYm90aCBhdXRoZW50aWNhdGVkIGFuZCB1bi1hdXRoZW50aWNhdGVkIHVzZXJzIHRvIG1ha2UgcmVxdWVzdHNcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gcmVxIC0gSW5jb21pbmcgcmVxdWVzdFxuICAgICAqIEBwYXJhbSB7T2JqZWN0fSByZXMgLSBTZXJ2ZXIgcmVzcG9uc2VcbiAgICAgKiBAcGFyYW0ge0Z1bmN0aW9ufSBuZXh0IC0gTmV4dCBtaWRkbGV3YXJlXG4gICAgICovXG4gICAgQ2hlY2tBdXRoLnByb3RvdHlwZS5hbGxvd0FueSA9IGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xuICAgICAgICByZXR1cm4gdHNsaWJfMS5fX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciB1c2VyLCBlcnJvcl80O1xuICAgICAgICAgICAgcmV0dXJuIHRzbGliXzEuX19nZW5lcmF0b3IodGhpcywgZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChfYS5sYWJlbCkge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICBfYS50cnlzLnB1c2goWzAsIDIsICwgM10pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFs0IC8qeWllbGQqLywgdGhpcy5nZXRVc2VyRnJvbVJlcXVlc3QocmVxKV07XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXIgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXEuY29udGFpbmVyLnJlZ2lzdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50VXNlcjogKDAsIGF3aWxpeF8xLmFzVmFsdWUpKHVzZXIsIHsgbGlmZXRpbWU6IGF3aWxpeF8xLkxpZmV0aW1lLlNDT1BFRCB9KSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFszIC8qYnJlYWsqLywgM107XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yXzQgPSBfYS5zZW50KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoand0XzEuZGVmYXVsdC5pc0pXVEVycm9yKGVycm9yXzQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IFVuYXV0aG9yaXplZF8xLmRlZmF1bHQoXCJGYWlsZWQgdG8gdmVyaWZ5IHJlcXVlc3QgdG9rZW4gLSBcIi5jb25jYXQoZXJyb3JfNC5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnJvcl80O1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDM6IHJldHVybiBbMiAvKnJldHVybiovXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICByZXR1cm4gQ2hlY2tBdXRoO1xufSgpKTtcbmV4cG9ydHMuZGVmYXVsdCA9IENoZWNrQXV0aDtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFDWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFBRUMsS0FBSyxFQUFFO0FBQUssQ0FBQyxDQUFDO0FBQzdELElBQUlDLE9BQU8sR0FBR0MsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUM5QjtBQUNBO0FBQ0E7QUFDQSxJQUFJQyxRQUFRLEdBQUdELE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDaEMsSUFBSUUsS0FBSyxHQUFHSCxPQUFPLENBQUNJLGVBQWUsQ0FBQ0gsT0FBTyx3QkFBZSxDQUFDO0FBQzNELElBQUlJLGNBQWMsR0FBR0wsT0FBTyxDQUFDSSxlQUFlLENBQUNILE9BQU8sMEJBQXVDLENBQUM7QUFDNUY7QUFDQTtBQUNBO0FBQ0EsSUFBSUss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
