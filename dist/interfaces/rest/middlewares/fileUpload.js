"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true,
});
var tslib_1 = require("tslib");
/**
 * @module lib/uploader
 * @description Parses a multipart form and uploads the specified files to disk
 */
var multer_1 = tslib_1.__importDefault(require("multer"));
var constants_1 = require("../../../helpers/constants");
var InvalidPayloadError_1 = tslib_1.__importDefault(require("../errors/InvalidPayloadError"));
var ONE_MB = 1000000;
var diskStorage = multer_1.default.diskStorage({
  destination: "temp/uploads",
  filename: function (req, file, cb) {
    var uniqueSuffix = ""
      .concat(Date.now(), "-")
      .concat(Math.round(Math.random() * 1e9), "-")
      .concat(file.originalname);
    cb(null, "".concat(file.fieldname, "-").concat(uniqueSuffix));
  },
});
/**
 * Validates files to ensure that they are in the correct format before uploading
 * @param {String} [fileType="image"] - The expected file type
 */
var fileFilter = function (fileType) {
  if (fileType === void 0) {
    fileType = "image";
  }
  return function (req, file, cb) {
    switch (fileType) {
      case "image":
        if (file.mimetype === "image/jpeg" || file.mimetype === "image/png") {
          cb(null, true);
        } else {
          cb(new InvalidPayloadError_1.default("Only images are allowed"));
        }
        break;
      case "csv":
        if (file.mimetype === "text/csv") {
          cb(null, true);
        } else {
          cb(new InvalidPayloadError_1.default("Only CSVs are allowed"));
        }
        break;
      case "pdf":
        if (file.mimetype === "application/pdf") {
          cb(null, true);
        } else {
          cb(new InvalidPayloadError_1.default("Only PDFs are allowed"));
        }
        break;
      case "video":
        if (["video/mp4", "video/3gpp"].includes(file.mimetype)) {
          cb(null, true);
        } else {
          cb(new InvalidPayloadError_1.default("Only .mp4 and .3gpp formats are allowed"));
        }
        break;
      case "document":
        if (
          [
            "application/pdf",
            "image/jpeg",
            "image/png",
            "application/msword",
            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
          ].includes(file.mimetype)
        ) {
          cb(null, true);
        } else {
          cb(new InvalidPayloadError_1.default("Only PDF, word documents, and images are allowed"));
        }
        break;
      default:
        cb(new InvalidPayloadError_1.default("Unknown file Type"));
        break;
    }
  };
};
/**
 * Returns a middleware for parsing multipart forms
 * @param {Object} data - Data about the file being uploaded
 * @param {String} data.fileType - The type of file e.g image, pdf
 * @param {String} data.fieldName - The name of the form-data field containing the file
 */
// eslint-disable-next-line func-names
var uploader = function (_a) {
  var fileType = _a.fileType,
    fieldName = _a.fieldName,
    fields = _a.fields;
  return function (req, res, next) {
    var multerInstance = (0, multer_1.default)({
      storage: diskStorage,
      fileFilter: fileFilter(fileType),
      limits: {
        fileSize: fileType === "video" ? null : constants_1.MAX_FILE_UPLOAD_SIZE,
      },
    });
    var uploadMiddleware =
      fields && fields.length ? multerInstance.fields(fields) : multerInstance.single(fieldName);
    uploadMiddleware(req, res, function (error) {
      if (error) {
        var message = "Upload error: ".concat(error.message, ".");
        switch (error.code) {
          case "LIMIT_FILE_SIZE": {
            var uploadLimitInMB = (constants_1.MAX_FILE_UPLOAD_SIZE / ONE_MB).toFixed(2);
            return next(
              new InvalidPayloadError_1.default(
                ""
                  .concat(message, " Only files smaller than ")
                  .concat(constants_1.MAX_FILE_UPLOAD_SIZE, " bytes") +
                  " (".concat(uploadLimitInMB, "MB) are allowed"),
              ),
            );
          }
          case "LIMIT_UNEXPECTED_FILE":
            return next(
              new InvalidPayloadError_1.default(
                "".concat(message, " Document should be uploaded using ") +
                  "'".concat(
                    fields && fields.length
                      ? fields.map(function (el) {
                          return el.name;
                        })
                      : fieldName,
                    "' field(s)",
                  ),
              ),
            );
          default:
            return next(new InvalidPayloadError_1.default(message));
        }
      }
      return next();
    });
  };
};
exports.default = uploader;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsInRzbGliXzEiLCJyZXF1aXJlIiwibXVsdGVyXzEiLCJfX2ltcG9ydERlZmF1bHQiLCJjb25zdGFudHNfMSIsIkludmFsaWRQYXlsb2FkRXJyb3JfMSIsIk9ORV9NQiIsImRpc2tTdG9yYWdlIiwiZGVmYXVsdCIsImRlc3RpbmF0aW9uIiwiZmlsZW5hbWUiLCJyZXEiLCJmaWxlIiwiY2IiLCJ1bmlxdWVTdWZmaXgiLCJjb25jYXQiLCJEYXRlIiwibm93IiwiTWF0aCIsInJvdW5kIiwicmFuZG9tIiwib3JpZ2luYWxuYW1lIiwiZmllbGRuYW1lIiwiZmlsZUZpbHRlciIsImZpbGVUeXBlIiwibWltZXR5cGUiLCJpbmNsdWRlcyIsInVwbG9hZGVyIiwiX2EiLCJmaWVsZE5hbWUiLCJmaWVsZHMiLCJyZXMiLCJuZXh0IiwibXVsdGVySW5zdGFuY2UiLCJzdG9yYWdlIiwibGltaXRzIiwiZmlsZVNpemUiLCJNQVhfRklMRV9VUExPQURfU0laRSIsInVwbG9hZE1pZGRsZXdhcmUiLCJsZW5ndGgiLCJzaW5nbGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJjb2RlIiwidXBsb2FkTGltaXRJbk1CIiwidG9GaXhlZCIsIm1hcCIsImVsIiwibmFtZSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3R5cGVkL2ludGVyZmFjZXMvcmVzdC9taWRkbGV3YXJlcy9maWxlVXBsb2FkLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIHRzbGliXzEgPSByZXF1aXJlKFwidHNsaWJcIik7XG4vKipcbiAqIEBtb2R1bGUgbGliL3VwbG9hZGVyXG4gKiBAZGVzY3JpcHRpb24gUGFyc2VzIGEgbXVsdGlwYXJ0IGZvcm0gYW5kIHVwbG9hZHMgdGhlIHNwZWNpZmllZCBmaWxlcyB0byBkaXNrXG4gKi9cbnZhciBtdWx0ZXJfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCJtdWx0ZXJcIikpO1xudmFyIGNvbnN0YW50c18xID0gcmVxdWlyZShcImhlbHBlcnMvY29uc3RhbnRzXCIpO1xudmFyIEludmFsaWRQYXlsb2FkRXJyb3JfMSA9IHRzbGliXzEuX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9lcnJvcnMvSW52YWxpZFBheWxvYWRFcnJvclwiKSk7XG52YXIgT05FX01CID0gMTAwMDAwMDtcbnZhciBkaXNrU3RvcmFnZSA9IG11bHRlcl8xLmRlZmF1bHQuZGlza1N0b3JhZ2Uoe1xuICAgIGRlc3RpbmF0aW9uOiBcInRlbXAvdXBsb2Fkc1wiLFxuICAgIGZpbGVuYW1lOiBmdW5jdGlvbiAocmVxLCBmaWxlLCBjYikge1xuICAgICAgICB2YXIgdW5pcXVlU3VmZml4ID0gXCJcIi5jb25jYXQoRGF0ZS5ub3coKSwgXCItXCIpLmNvbmNhdChNYXRoLnJvdW5kKE1hdGgucmFuZG9tKCkgKiAxZTkpLCBcIi1cIikuY29uY2F0KGZpbGUub3JpZ2luYWxuYW1lKTtcbiAgICAgICAgY2IobnVsbCwgXCJcIi5jb25jYXQoZmlsZS5maWVsZG5hbWUsIFwiLVwiKS5jb25jYXQodW5pcXVlU3VmZml4KSk7XG4gICAgfSxcbn0pO1xuLyoqXG4gKiBWYWxpZGF0ZXMgZmlsZXMgdG8gZW5zdXJlIHRoYXQgdGhleSBhcmUgaW4gdGhlIGNvcnJlY3QgZm9ybWF0IGJlZm9yZSB1cGxvYWRpbmdcbiAqIEBwYXJhbSB7U3RyaW5nfSBbZmlsZVR5cGU9XCJpbWFnZVwiXSAtIFRoZSBleHBlY3RlZCBmaWxlIHR5cGVcbiAqL1xudmFyIGZpbGVGaWx0ZXIgPSBmdW5jdGlvbiAoZmlsZVR5cGUpIHtcbiAgICBpZiAoZmlsZVR5cGUgPT09IHZvaWQgMCkgeyBmaWxlVHlwZSA9IFwiaW1hZ2VcIjsgfVxuICAgIHJldHVybiBmdW5jdGlvbiAocmVxLCBmaWxlLCBjYikge1xuICAgICAgICBzd2l0Y2ggKGZpbGVUeXBlKSB7XG4gICAgICAgICAgICBjYXNlIFwiaW1hZ2VcIjpcbiAgICAgICAgICAgICAgICBpZiAoZmlsZS5taW1ldHlwZSA9PT0gXCJpbWFnZS9qcGVnXCIgfHwgZmlsZS5taW1ldHlwZSA9PT0gXCJpbWFnZS9wbmdcIikge1xuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKG5ldyBJbnZhbGlkUGF5bG9hZEVycm9yXzEuZGVmYXVsdChcIk9ubHkgaW1hZ2VzIGFyZSBhbGxvd2VkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwiY3N2XCI6XG4gICAgICAgICAgICAgICAgaWYgKGZpbGUubWltZXR5cGUgPT09IFwidGV4dC9jc3ZcIikge1xuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKG5ldyBJbnZhbGlkUGF5bG9hZEVycm9yXzEuZGVmYXVsdChcIk9ubHkgQ1NWcyBhcmUgYWxsb3dlZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcInBkZlwiOlxuICAgICAgICAgICAgICAgIGlmIChmaWxlLm1pbWV0eXBlID09PSBcImFwcGxpY2F0aW9uL3BkZlwiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2IobmV3IEludmFsaWRQYXlsb2FkRXJyb3JfMS5kZWZhdWx0KFwiT25seSBQREZzIGFyZSBhbGxvd2VkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIFwidmlkZW9cIjpcbiAgICAgICAgICAgICAgICBpZiAoW1widmlkZW8vbXA0XCIsIFwidmlkZW8vM2dwcFwiXS5pbmNsdWRlcyhmaWxlLm1pbWV0eXBlKSkge1xuICAgICAgICAgICAgICAgICAgICBjYihudWxsLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKG5ldyBJbnZhbGlkUGF5bG9hZEVycm9yXzEuZGVmYXVsdChcIk9ubHkgLm1wNCBhbmQgLjNncHAgZm9ybWF0cyBhcmUgYWxsb3dlZFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSBcImRvY3VtZW50XCI6XG4gICAgICAgICAgICAgICAgaWYgKFtcbiAgICAgICAgICAgICAgICAgICAgXCJhcHBsaWNhdGlvbi9wZGZcIixcbiAgICAgICAgICAgICAgICAgICAgXCJpbWFnZS9qcGVnXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaW1hZ2UvcG5nXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vbXN3b3JkXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnRcIixcbiAgICAgICAgICAgICAgICBdLmluY2x1ZGVzKGZpbGUubWltZXR5cGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNiKG51bGwsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2IobmV3IEludmFsaWRQYXlsb2FkRXJyb3JfMS5kZWZhdWx0KFwiT25seSBQREYsIHdvcmQgZG9jdW1lbnRzLCBhbmQgaW1hZ2VzIGFyZSBhbGxvd2VkXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNiKG5ldyBJbnZhbGlkUGF5bG9hZEVycm9yXzEuZGVmYXVsdChcIlVua25vd24gZmlsZSBUeXBlXCIpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH07XG59O1xuLyoqXG4gKiBSZXR1cm5zIGEgbWlkZGxld2FyZSBmb3IgcGFyc2luZyBtdWx0aXBhcnQgZm9ybXNcbiAqIEBwYXJhbSB7T2JqZWN0fSBkYXRhIC0gRGF0YSBhYm91dCB0aGUgZmlsZSBiZWluZyB1cGxvYWRlZFxuICogQHBhcmFtIHtTdHJpbmd9IGRhdGEuZmlsZVR5cGUgLSBUaGUgdHlwZSBvZiBmaWxlIGUuZyBpbWFnZSwgcGRmXG4gKiBAcGFyYW0ge1N0cmluZ30gZGF0YS5maWVsZE5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZm9ybS1kYXRhIGZpZWxkIGNvbnRhaW5pbmcgdGhlIGZpbGVcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGZ1bmMtbmFtZXNcbnZhciB1cGxvYWRlciA9IGZ1bmN0aW9uIChfYSkge1xuICAgIHZhciBmaWxlVHlwZSA9IF9hLmZpbGVUeXBlLCBmaWVsZE5hbWUgPSBfYS5maWVsZE5hbWUsIGZpZWxkcyA9IF9hLmZpZWxkcztcbiAgICByZXR1cm4gZnVuY3Rpb24gKHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgICAgIHZhciBtdWx0ZXJJbnN0YW5jZSA9ICgwLCBtdWx0ZXJfMS5kZWZhdWx0KSh7XG4gICAgICAgICAgICBzdG9yYWdlOiBkaXNrU3RvcmFnZSxcbiAgICAgICAgICAgIGZpbGVGaWx0ZXI6IGZpbGVGaWx0ZXIoZmlsZVR5cGUpLFxuICAgICAgICAgICAgbGltaXRzOiB7XG4gICAgICAgICAgICAgICAgZmlsZVNpemU6IGZpbGVUeXBlID09PSBcInZpZGVvXCIgPyBudWxsIDogY29uc3RhbnRzXzEuTUFYX0ZJTEVfVVBMT0FEX1NJWkUsXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgICAgdmFyIHVwbG9hZE1pZGRsZXdhcmUgPSBmaWVsZHMgJiYgZmllbGRzLmxlbmd0aCA/IG11bHRlckluc3RhbmNlLmZpZWxkcyhmaWVsZHMpIDogbXVsdGVySW5zdGFuY2Uuc2luZ2xlKGZpZWxkTmFtZSk7XG4gICAgICAgIHVwbG9hZE1pZGRsZXdhcmUocmVxLCByZXMsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBcIlVwbG9hZCBlcnJvcjogXCIuY29uY2F0KGVycm9yLm1lc3NhZ2UsIFwiLlwiKTtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGVycm9yLmNvZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSBcIkxJTUlUX0ZJTEVfU0laRVwiOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgdXBsb2FkTGltaXRJbk1CID0gKGNvbnN0YW50c18xLk1BWF9GSUxFX1VQTE9BRF9TSVpFIC8gT05FX01CKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHQobmV3IEludmFsaWRQYXlsb2FkRXJyb3JfMS5kZWZhdWx0KFwiXCIuY29uY2F0KG1lc3NhZ2UsIFwiIE9ubHkgZmlsZXMgc21hbGxlciB0aGFuIFwiKS5jb25jYXQoY29uc3RhbnRzXzEuTUFYX0ZJTEVfVVBMT0FEX1NJWkUsIFwiIGJ5dGVzXCIpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIiAoXCIuY29uY2F0KHVwbG9hZExpbWl0SW5NQiwgXCJNQikgYXJlIGFsbG93ZWRcIikpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXNlIFwiTElNSVRfVU5FWFBFQ1RFRF9GSUxFXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV4dChuZXcgSW52YWxpZFBheWxvYWRFcnJvcl8xLmRlZmF1bHQoXCJcIi5jb25jYXQobWVzc2FnZSwgXCIgRG9jdW1lbnQgc2hvdWxkIGJlIHVwbG9hZGVkIHVzaW5nIFwiKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCInXCIuY29uY2F0KGZpZWxkcyAmJiBmaWVsZHMubGVuZ3RoID8gZmllbGRzLm1hcChmdW5jdGlvbiAoZWwpIHsgcmV0dXJuIGVsLm5hbWU7IH0pIDogZmllbGROYW1lLCBcIicgZmllbGQocylcIikpKTtcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXh0KG5ldyBJbnZhbGlkUGF5bG9hZEVycm9yXzEuZGVmYXVsdChtZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbn07XG5leHBvcnRzLmRlZmF1bHQgPSB1cGxvYWRlcjtcbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWTs7QUFDWkEsTUFBTSxDQUFDQyxjQUFjLENBQUNDLE9BQU8sRUFBRSxZQUFZLEVBQUU7RUFBRUMsS0FBSyxFQUFFO0FBQUssQ0FBQyxDQUFDO0FBQzdELElBQUlDLE9BQU8sR0FBR0MsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUM5QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLElBQUlDLFFBQVEsR0FBR0YsT0FBTyxDQUFDRyxlQUFlLENBQUNGLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUN6RCxJQUFJRyxXQUFXLEdBQUdILE9BQU8sOEJBQXFCO0FBQzlDLElBQUlJLHFCQUFxQixHQUFHTCxPQUFPLENBQUNHLGVBQWUsQ0FBQ0YsT0FBTyxpQ0FBaUMsQ0FBQztBQUM3RixJQUFJSyxNQUFNLEdBQUcsT0FBTztBQUNwQixJQUFJQyxXQUFXLEdBQUdMLFFBQVEs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
